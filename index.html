<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfelli ülevaade - Swedbank</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --swed-orange: #ee7023;
            --swed-yellow: #ffcc00;
            --text-gray: #555;
            --bg-gray: #f9f9f9;
        }

        body { font-family: Arial, sans-serif; background-color: white; margin: 40px; color: #333; }
        
        /* Navigation Tabs */
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 30px; }
        .tab { padding: 10px 20px; border-radius: 20px; background: #eee; font-size: 14px; cursor: pointer; color: #666; }
        .tab.active { background: var(--swed-yellow); color: black; font-weight: bold; }

        h2 { color: var(--swed-orange); font-size: 22px; margin-bottom: 20px; }

        .main-content { display: flex; justify-content: space-between; align-items: flex-start; gap: 50px; }

        /* Table Styling */
        .table-container { flex: 1; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 13px; border-bottom: 2px solid var(--swed-orange); padding: 10px 5px; color: black; }
        td { padding: 12px 5px; border-bottom: 1px solid #eee; font-size: 14px; }
        .row-total { font-weight: bold; border-top: 1px solid #ccc; }
        .positive { color: #588e00; font-weight: bold; }
        .link { color: #00768e; text-decoration: none; border-bottom: 1px solid transparent; }
        .link:hover { border-bottom: 1px solid #00768e; }

        /* Chart Area */
        .chart-container { width: 300px; text-align: center; }
        #chartLabel { margin-top: 15px; font-size: 14px; font-weight: bold; }

        /* Admin Panel for adding fake stocks */
        .admin-panel { margin-top: 50px; padding: 20px; border: 1px dashed #ccc; background: var(--bg-gray); border-radius: 8px; }
        .admin-panel input { padding: 8px; margin-right: 10px; border: 1px solid #ccc; }
        .admin-btn { background: var(--swed-orange); color: white; border: none; padding: 10px 15px; cursor: pointer; border-radius: 5px; }
    </style>
</head>
<body>

    <div class="nav-tabs">
        <div class="tab active">Investeeringud</div>
        <div class="tab">Arvelduskontod</div>
        <div class="tab">Pension</div>
        <div class="tab">Hoiused</div>
        <div class="tab">Kogumine elukindlustusega</div>
    </div>

    <h2>Portfelli ülevaade</h2>

    <div class="main-content">
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th style="width: 40%;">Vara liik</th>
                        <th style="width: 30%; text-align: right;">Kasum</th>
                        <th style="width: 30%; text-align: right;">Väärtus (EUR)</th>
                    </tr>
                </thead>
                <tbody id="portfolioBody">
                    </tbody>
                <tfoot>
                    <tr class="row-total">
                        <td>Portfell kokku</td>
                        <td id="totalProfit" class="positive" style="text-align: right;">0.00 EUR / 0.00%</td>
                        <td id="totalValue" style="text-align: right;">0.00</td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="chart-container">
            <canvas id="portfolioChart"></canvas>
            <div id="chartLabel"></div>
        </div>
    </div>

    <div class="admin-panel">
        <h3>Halda oma "aktsiaid"</h3>
        <input type="text" id="assetName" placeholder="Vara nimi (nt: Fondid)">
        <input type="number" id="assetValue" placeholder="Väärtus (EUR)">
        <input type="number" id="assetProfit" placeholder="Kasum (EUR)">
        <button class="admin-btn" onclick="addAsset()">Lisa / Uuenda</button>
        <button style="background: #999;" class="admin-btn" onclick="clearData()">Tühjenda</button>
    </div>

<script>
    let myAssets = JSON.parse(localStorage.getItem('swedMockData')) || [
        { name: 'Raha', value: 0, profit: 0 },
        { name: 'Fondid', value: 24.48, profit: 4.48 }
    ];

    let chartInstance = null;

    function render() {
        const body = document.getElementById('portfolioBody');
        body.innerHTML = '';
        let totalV = 0;
        let totalP = 0;

        myAssets.forEach((asset) => {
            totalV += asset.value;
            totalP += asset.profit;
            const perc = asset.value > 0 ? ((asset.profit / (asset.value - asset.profit)) * 100).toFixed(2) : "0.00";
            
            body.innerHTML += `
                <tr>
                    <td><a href="#" class="link">${asset.name}</a></td>
                    <td class="positive" style="text-align: right;">${asset.profit.toFixed(2)} EUR / ${perc}%</td>
                    <td style="text-align: right;">${asset.value.toFixed(2)}</td>
                </tr>
            `;
        });

        // Update Totals
        const totalPerc = totalV > 0 ? ((totalP / (totalV - totalP)) * 100).toFixed(2) : "0.00";
        document.getElementById('totalValue').innerText = totalV.toFixed(2);
        document.getElementById('totalProfit').innerText = `${totalP.toFixed(2)} EUR / ${totalPerc}%`;

        localStorage.setItem('swedMockData', JSON.stringify(myAssets));
        updateChart();
    }

    function addAsset() {
        const name = document.getElementById('assetName').value;
        const val = parseFloat(document.getElementById('assetValue').value);
        const prof = parseFloat(document.getElementById('assetProfit').value);

        if(name && !isNaN(val)) {
            myAssets.push({ name, value: val, profit: prof || 0 });
            render();
        }
    }

    function clearData() {
        myAssets = [];
        render();
    }

    function updateChart() {
        const ctx = document.getElementById('portfolioChart').getContext('2d');
        const labels = myAssets.map(a => a.name);
        const data = myAssets.map(a => a.value);

        if(chartInstance) chartInstance.destroy();

        chartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: ['#ee7023', '#ffcc00', '#00768e', '#588e00'],
                    borderWidth: 0
                }]
            },
            options: {
                cutout: '70%',
                plugins: { legend: { display: false } }
            }
        });
        
        const labelDiv = document.getElementById('chartLabel');
        labelDiv.innerHTML = labels.map((l, i) => `<span style="color: #ee7023">●</span> ${l} 100%`).join('<br>');
    }

    render();
</script>
</body>
</html>
